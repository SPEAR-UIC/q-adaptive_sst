![SST](http://sst-simulator.org/img/sst-logo-small.png)

# Structural Simulation Toolkit (SST)

#### This repository contains customized [sst-core](https://github.com/SPEAR-IIT/sst-core) and [sst-elements](https://github.com/SPEAR-IIT/sst-elements) forked from [SST Github page](https://github.com/sstsimulator/sst-elements) maintained by [SPEAR group](http://www.cs.iit.edu/~zlan/) at IIT.  
Visit [sst-simulator.org](http://sst-simulator.org) to learn more about SST.

---
## Study of Workload Interference with Intelligent Routing on Dragonfly

The submodules of sst-core and sst-elements contain the toolkit enhancement for Dragonfly network interference study.

### Installation 
1. Download sst-core and sst-elements from this repository, use other SST versions may cause compatible issue.  
```bash
git clone -b df_interference_rl --recurse-submodules https://github.com/SPEAR-IIT/q-adaptive_sst.git
```

2. Follow [installation guide](http://sst-simulator.org/SSTPages/SSTBuildAndInstall_11dot1dot0_SeriesDetailedBuildInstructions/) to install SST.

### Run a Test

check https://github.com/SPEAR-IIT/sst-elements/tree/df_interference_rl for a Cosmoflow and Uniform Random interference case study

### Docker Container
The package under this repository provides a docker image with precompiled SST binary under */home/df_user/sst*
```bash
# pull the image
docker pull ghcr.io/spear-iit/sst_q-adaptive:df_interference_rl

# create a working directory and launch the container
cd q-adaptive_sst
mkdir -m 777 wkdir
docker run -it --user df_user \
    -v /path_to/wkdir:/home/df_user/mnt/wkdir,/path_to/q-adaptive_sst:/home/df_user/q-adaptive_sst \
    ghcr.io/spear-iit/sst_q-adaptive:df_interference_rl
```

### Network Analysis Workflow

The network interference analysis consists of three steps. 
For example, to investigate Cosmoflow network performance with Q-adaptive routing when it is the only job in the system:

```bash
# 1. Launch experiments 
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target cosmoflow --background null --rting q-adaptive 

# 2. Preprocess raw data
q-adaptive_sst/scripts/cat_csv.sh emberlog cosmoflow   # for app communication time
q-adaptive_sst/scritps/cat_csv.sh linkcontrol 0        # for app packet latency and throughput, 0--target app, 1--background app

# 3. Result visualization (Please consider updating file path in the script accordingly)
python3 pairwise_app_latecy_bw.py 
python3 pairwise_app_comm_time.py
```
The following figure depicts the Cosmoflow network throughput generated by *pairwise_app_comm_time.py*. 

Notice that in the figure, the timeline does not start with 0 since Cosmoflow starts with long computation, and two waves of allreduce operations are observed at around 5ms and 12ms

<figure>
	<img align="middle" src="https://github.com/SPEAR-IIT/q-adaptive_sst/blob/df_interference_rl/scripts/fig/cosmoflow_bw_vs_time.png" / width="400">
</figure>


### Paper Results Reproduction
All the results discussed in the paper can be obtained using the above workflow.

#### Pairwise workload analysis
For example, to investigate Cosmoflow performance when paired with Halo3D application using Q-adaptive and PAR.

```bash
# launch experiments
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target cosmoflow --background halo3d --rting q-adaptive  ## interference run
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target cosmoflow --background null --rting q-adaptive    ## cosmoflow baseline run
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target null --background halo3d --rting q-adaptive       ## halo3d baseline run

q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target cosmoflow --background halo3d --rting par  ## interference run
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target cosmoflow --background null --rting par    ## cosmoflow baseline run
q-adaptive_sst/scripts/run_sst_motif.sh pairwise --target null --background halo3d --rting par       ## halo3d baseline run

# preprocess raw data
q-adaptive_sst/scritps/cat_csv.sh emberlog cosmoflow    
q-adaptive_sst/scritps/cat_csv.sh linkcontrol 0     
q-adaptive_sst/scritps/cat_csv.sh linkcontrol 1
```

* To visualize Cosmoflow communication time under different routing algorithms:

```bash
## update cosmoflow_halo3d folder path in the script
python3 pairwise_app_comm_time.py
```

<figure>
	<img align="middle" src="https://github.com/SPEAR-IIT/q-adaptive_sst/blob/df_interference_rl/scripts/fig/comm_time_cosmoflow_halo3d.png" / width="400">
</figure>

This is indeed Figure4(d) in the paper. The plot could be complemented with additional experiments under different background applications and routing algorithms using *run_sst_motif.sh* script.

* To visualize Cosmoflow network throughput
```bash
## update cosmoflow_halo3d folder path in the script
python3 pairwise_app_latecy_bw.py 
```

<figure>
	<img align="middle" src="https://github.com/SPEAR-IIT/q-adaptive_sst/blob/df_interference_rl/scripts/fig/cosmoflow_halo3d_bw.png" / width="400">
</figure>

Notice the different locations of peak throughput indicate network interference and routing performance difference between Q-adaptive and PAR.

* To regenerate Figure9 in the paper

```bash
python3 cosmoflow_halo3d_thput.py
```
<figure>
	<img align="middle" src="https://github.com/SPEAR-IIT/q-adaptive_sst/blob/df_interference_rl/scripts/fig/Figure9.png" / width="400">
</figure>

Other target-background application pair can be analyzed in the same procedure.

#### Mixed workload analysis

For example, to investigate system-wide network performance under Q-adaptive and PAR

```bash
# launch experiments
q-adaptive_sst/scripts/run_sst_motif.sh mixed --target all --rting q-adaptive  ## 6 application interference run
q-adaptive_sst/scripts/run_sst_motif.sh mixed --target all --rting par         ## 6 application interference run

# preprocess raw data
q-adaptive_sst/scritps/cat_csv.sh stats    ## for link traffic and stall time
q-adaptive_sst/scritps/cat_csv.sh linkcontrol <jobid: 0--5 for 6 applications>
q-adaptive_sst/scritps/cat_csv.sh linkall  ## combine 6 applications data into one file

# plot congestion index, consider update data directory in the script
python3 mixed_sys_congestion_index.py
```

<figure>
	<img align="middle" src="https://github.com/SPEAR-IIT/q-adaptive_sst/blob/df_interference_rl/scripts/fig/mixed-workload-congestion-index.png" / width="400">
</figure>

Individual application can be launched with  
```bash
q-adaptive_sst/scripts/run_sst_motif.sh mixed --target <appname> --rting <routing algorithm>
```

If all mixed workload experiments are launched, check
```bash
mixed_sys_comm_time.py                    # application communication time, Figure 10 in the paper
mixed_sys_stall_time.py                   # Link stall time analysis, Figure 11 in the paper
mixed_sys_latency_boxplot_throughput.py   # packet latency distribution & throughput, Figure 13 in the paper
```
---


##### [LICENSE](https://github.com/sstsimulator/sst-elements/blob/devel/LICENSE)
